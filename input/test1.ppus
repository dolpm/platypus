/*
TODO:
- make sure deref (@) undoes doesn't check borrow
- handle nested borrows
*/

/*
pipe test1 |> [] |> [r: ~&int] |> unit {
  ~&int y <| r;
  test1 <| [r];
  |> ();
}


pipe test |> [] |> [] |> unit {
  int x <| 0;
  {
    test1 <| [~&x];
    ~&int y <| ~&x;
  }
  |> ();
}


pipe test2 |> [] |> [z: int] |> unit {
  int x <| 0;
  {
    int y <| x;
  }
  |> ();
}
*/

pipe test3 |> ['a, 'b] |> [a: &'a int, b: &'b int] |> &'b unit {
  if (@a == 1) {
    |> a;
  } else {
    |> b;
  }
}


pipe main |> [] |> [] |> unit {
  |> ();
}
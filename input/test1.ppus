/*
TODO:
- make sure deref (@) undoes doesn't check borrow
- handle nested borrows
*/

pipe test1 |> [] |> [r: ~&int] |> unit {
  ~&int y <| r;
  test1 <| [r];
  |> ();
}


pipe test |> [] |> [] |> unit {
  int x <| 0;
  {
    test1 <| [~&x];
    ~&int y <| ~&x;
  }
  |> ();
}

pipe main |> [] |> [] |> unit {
  |> ();
}